!function(){"use strict";let e=null,t=0,i=new Map,o=null,n=!1,s=null,a=null;class r{constructor(){this.particleSystems=new Map,this.targetElements=new Map,this.renderers=new Map,this.mouse=new THREE.Vector2,this.lastMousePos=new THREE.Vector2,this.mouseVelocity=new THREE.Vector2,this.onMouseMove=this.onMouseMove.bind(this),this.onTouchMove=this.onTouchMove.bind(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("touchstart",this.onTouchMove,{passive:!1}),document.addEventListener("touchmove",this.onTouchMove,{passive:!1})}addParticleSystem(e,t,i,o){const n=new THREE.WebGLRenderer({antialias:!0,powerPreference:"high-performance",alpha:!0}),s=Math.min(window.devicePixelRatio,2);n.setPixelRatio(s),n.setClearColor(0,0);const a=new THREE.Scene,r=new THREE.PerspectiveCamera(75,1,.1,1e3);r.position.z=1.15,a.add(t);const l=function(e){let t=0,i=!1,o=e;for(;o&&o!==document.body;){const e=window.getComputedStyle(o),n=e.position,s=parseInt(e.zIndex,10);"fixed"===n&&(i=!0),"static"===n||isNaN(s)||(t=Math.max(t,s)),o=o.parentElement}const n=window.getComputedStyle(e),s=parseInt(n.zIndex,10);"static"===n.position||isNaN(s)||(t=Math.max(t,s));return{position:i?"fixed":"absolute",zIndex:t,isFixedContext:i}}(i),c=n.domElement;if(c.setAttribute("data-particles-target",e),l.isFixedContext?document.body.appendChild(c):i.parentNode.insertBefore(c,i),this.renderers.set(e,{renderer:n,scene:a,camera:r}),this.particleSystems.set(e,{system:t,element:i,options:o,inView:!1,observer:null,originalVisibility:i.style.visibility,targetRotation:new THREE.Vector2,isMouseOver:!1,resetAnimation:{x:0,y:0},currentMouse:new THREE.Vector2,lastMousePos:new THREE.Vector2,stacking:l,mouseVelocity:0,isMoving:!1,inactivityTimer:0,effectRadius:0,targetEffectRadius:0,lastMoveTime:0,isVideo:"video"===i.tagName.toLowerCase(),videoCanvas:null,videoContext:null,lastVideoUpdate:0,videoUpdateInterval:o.videoUpdateRate||100}),this.targetElements.set(e,i),"IntersectionObserver"in window){const t=new IntersectionObserver(t=>{const i=this.particleSystems.get(e);i&&(i.inView=t[0].isIntersecting)},{root:null,threshold:0,rootMargin:"500px"});t.observe(i),this.particleSystems.get(e).observer=t}else this.particleSystems.get(e).inView=!0;setTimeout(()=>{i.style.visibility="hidden"},16)}removeParticleSystem(e,t=!1){const i=this.particleSystems.get(e),o=this.renderers.get(e);if(i){t||setTimeout(()=>{i.element.style.visibility=i.originalVisibility||""},16);const o=document.querySelector(`canvas[data-particles-target="${e}"]`);o&&o.remove(),i.system.geometry&&i.system.geometry.dispose(),i.system.material&&(i.system.material.map&&i.system.material.map.dispose(),i.system.material.dispose()),i.observer&&i.observer.disconnect(),i.videoCanvas&&(i.videoCanvas=null,i.videoContext=null),this.particleSystems.delete(e),this.targetElements.delete(e)}o&&(o.renderer&&o.renderer.dispose(),this.renderers.delete(e))}onMouseMove(e){for(const[t,i]of this.particleSystems){const o=i.element.getBoundingClientRect(),n=e.clientX>=o.left&&e.clientX<=o.right&&e.clientY>=o.top&&e.clientY<=o.bottom;if(n&&!i.isMouseOver?i.isMouseOver=!0:!n&&i.isMouseOver&&(i.isMouseOver=!1,this.startResetAnimation(t)),n){const t=e.clientX-o.left,n=e.clientY-o.top;let s=t/o.width*2-1;const a=-n/o.height*2+1;"true"===i.element.dataset.flipHorizontal&&(s=-s);const r=new THREE.Vector2(s,a),l=r.clone().sub(i.currentMouse);i.mouseVelocity=l.length(),i.lastMoveTime=performance.now(),i.isMoving=i.mouseVelocity>.001,i.isMoving&&(i.inactivityTimer=0),i.options.tilt&&(i.targetRotation.x=a*i.options.tiltFactor,i.targetRotation.y=s*i.options.tiltFactor),i.currentMouse.copy(r)}}}onTouchMove(e){if(e.touches.length>0){const t=e.touches[0],i=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});this.onMouseMove(i)}}startResetAnimation(e){const t=this.particleSystems.get(e);if(!t)return;t.resetAnimation.x=t.targetRotation.x,t.resetAnimation.y=t.targetRotation.y;const i=()=>{t.resetAnimation.x+=.08*(0-t.resetAnimation.x),t.resetAnimation.y+=.08*(0-t.resetAnimation.y),t.targetRotation.x=t.resetAnimation.x,t.targetRotation.y=t.resetAnimation.y,Math.abs(t.resetAnimation.x)>.001||Math.abs(t.resetAnimation.y)>.001?requestAnimationFrame(i):(t.targetRotation.x=0,t.targetRotation.y=0,t.resetAnimation.x=0,t.resetAnimation.y=0)};i()}animate(){if(n){for(const[e,t]of this.particleSystems){if(!t.inView)continue;const{system:i,options:o}=t,n=this.renderers.get(e);if(!n)continue;const{renderer:s,scene:a,camera:r}=n;if(t.externalRadiusUpdate)t.targetEffectRadius=o.displaceRadius,t.externalRadiusUpdate=!1;else if(t.isMouseOver){performance.now()-t.lastMoveTime>100&&(t.isMoving=!1),t.targetEffectRadius=t.isMoving?o.displaceRadius:0}else t.targetEffectRadius=0,t.isMoving=!1;const l=.08,c=t.targetEffectRadius-t.effectRadius;Math.abs(c)>.001?t.effectRadius+=c*l:t.effectRadius=t.targetEffectRadius,i.rotation&&(i.rotation.x+=(t.targetRotation.x-i.rotation.x)*o.tiltSpeed,i.rotation.y+=(t.targetRotation.y-i.rotation.y)*o.tiltSpeed),t.isVideo&&this.updateVideoParticles(e,t);const d=t.element.getBoundingClientRect();if(!(d.width>0&&d.height>0))continue;r.aspect=d.width/d.height,r.updateProjectionMatrix(),s.setSize(d.width,d.height);const m=r.fov*(Math.PI/180),h=2*Math.tan(m/2)*r.position.z,p=h*r.aspect,u=new THREE.Vector2(t.currentMouse.x*(p/2),t.currentMouse.y*(h/2));this.applyGlitchEffect(i,o,t,u);const f=s.domElement,g=t.stacking;if(f.style.position=g.position,f.style.display="block",f.style.visibility="visible","fixed"===g.position)f.style.top=`${d.top}px`,f.style.left=`${d.left}px`,f.style.zIndex=g.zIndex+1;else{f.style.top=`${t.element.offsetTop}px`,f.style.left=`${t.element.offsetLeft}px`;const e=window.getComputedStyle(t.element);f.style.zIndex="auto"===e.zIndex?"0":e.zIndex}f.style.width=`${d.width}px`,f.style.height=`${d.height}px`,f.style.pointerEvents="none",s.render(a,r)}o=requestAnimationFrame(()=>this.animate())}}applyGlitchEffect(e,t,i,o){if(!e||!e.geometry)return;const n=e.geometry.attributes.position,s=e.geometry.attributes.originalPosition;if(!n||!s)return;const a=i.effectRadius;if(a<.001){const e=n.array,i=s.array;for(let o=0;o<e.length;o+=3){const n=t.returnSpeed;e[o]+=(i[o]-e[o])*n,e[o+1]+=(i[o+1]-e[o+1])*n}return void(n.needsUpdate=!0)}const r=n.array,l=s.array,c=i.currentMouse,d=c.clone().sub(i.lastMousePos);i.lastMousePos.copy(c);const m=Math.atan2(d.y,d.x);for(let e=0;e<r.length;e+=3){const i=new THREE.Vector2(r[e],r[e+1]),n=o.distanceTo(i);if(n>2*a){const i=t.returnSpeed;r[e]+=(l[e]-r[e])*i,r[e+1]+=(l[e+1]-r[e+1])*i;continue}const s=n/a,c=Math.exp(-s*s*2);if(c>.01){const n=Math.atan2(i.y-o.y,i.x-o.x)+m*t.velocityInfluence,s=(Math.random()-.5)*Math.PI*.5,a=c*t.displaceStrength*(1+.5*Math.random()),d=new THREE.Vector2(Math.cos(n+s)*a,Math.sin(n+s)*a);r[e]=l[e]+d.x,r[e+1]=l[e+1]+d.y}else r[e]+=(l[e]-r[e])*t.returnSpeed,r[e+1]+=(l[e+1]-r[e+1])*t.returnSpeed}n.needsUpdate=!0}updateVideoParticles(e,t){const i=performance.now();if(i-t.lastVideoUpdate<t.videoUpdateInterval)return;const o=t.element;if(o.readyState>=2&&!o.paused&&!o.ended){if(!t.videoCanvas){const e=2048,i=(o.videoWidth||16)/(o.videoHeight||9);t.videoCanvas=document.createElement("canvas"),i>=1?(t.videoCanvas.width=e,t.videoCanvas.height=Math.round(e/i)):(t.videoCanvas.height=e,t.videoCanvas.width=Math.round(e*i)),t.videoContext=t.videoCanvas.getContext("2d",{willReadFrequently:!0})}const e=t.videoCanvas.width,n=t.videoCanvas.height;t.videoContext.clearRect(0,0,e,n),t.videoContext.drawImage(o,0,0,e,n);const s=t.videoContext.getImageData(0,0,e,n),a=[],r=[],l=80,c="sample"===t.options.particleColor;for(let i=0;i<n;i+=t.options.sampling)for(let o=0;o<e;o+=t.options.sampling){const d=4*(i*e+o),m=s.data[d],h=s.data[d+1],p=s.data[d+2],u=.299*m+.587*h+.114*p,f=Math.max(m,h,p);if(u>l&&f>50){const s=(o-e/2)*t.options.particleSpacing,l=(n/2-i)*t.options.particleSpacing;if(a.push(s,l,0),c){const e=m/255,t=h/255,i=p/255;r.push(e,t,i)}}}const d=t.system.geometry,m=d.attributes.position,h=d.attributes.originalPosition;if(a.length>0){if(m.array=new Float32Array(a),h.array=new Float32Array(a),d.setAttribute("position",new THREE.Float32BufferAttribute(a,3)),d.setAttribute("originalPosition",new THREE.Float32BufferAttribute(a,3)),c&&r.length>0){const e=d.attributes.color,t=d.attributes.originalColor;e&&(e.array=new Float32Array(r),t.array=new Float32Array(r),d.setAttribute("color",new THREE.Float32BufferAttribute(r,3)),d.setAttribute("originalColor",new THREE.Float32BufferAttribute(r,3)),e.needsUpdate=!0,t.needsUpdate=!0)}m.needsUpdate=!0,h.needsUpdate=!0}t.lastVideoUpdate=i}}startAnimation(){n||(n=!0,this.animate())}stopAnimation(){n&&(n=!1,o&&(cancelAnimationFrame(o),o=null))}dispose(){this.stopAnimation();for(const[e]of this.particleSystems)this.removeParticleSystem(e);document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("touchstart",this.onTouchMove),document.removeEventListener("touchmove",this.onTouchMove);for(const[e,t]of this.renderers)t.renderer&&t.renderer.dispose();this.particleSystems.clear(),this.targetElements.clear(),this.renderers.clear()}}async function l(e,t={}){const i=document.createElement("canvas"),o=i.getContext("2d",{willReadFrequently:!0});let n,s;const a=e.tagName.toLowerCase(),r=2048;if(["img","svg","canvas","video"].includes(a)){let t=0,i=0;if("img"===a)t=e.naturalWidth||0,i=e.naturalHeight||0;else if("video"===a)t=e.videoWidth||0,i=e.videoHeight||0;else if("canvas"===a)t=e.width||0,i=e.height||0;else if("svg"===a){const o=e.getAttribute("viewBox");if(o){const e=o.split(/[ ,]+/).map(Number);4===e.length&&(t=e[2],i=e[3])}}if(!t||!i){const o=e.getBoundingClientRect();t=o.width,i=o.height}const o=t/i||1;o>=1?(n=r,s=Math.round(r/o)):(s=r,n=Math.round(r*o))}else{const t=e.getBoundingClientRect(),i=4;n=Math.min(r,Math.round(t.width*i)),s=Math.min(r,Math.round(t.height*i))}i.width=n,i.height=s,o.clearRect(0,0,i.width,i.height);try{switch(e.tagName.toLowerCase()){case"img":await new Promise((t,i)=>{e.complete?(o.drawImage(e,0,0,n,s),t()):(e.onload=()=>{o.drawImage(e,0,0,n,s),t()},e.onerror=i)});break;case"svg":const i=(new XMLSerializer).serializeToString(e),a=new Blob([i],{type:"image/svg+xml"}),r=URL.createObjectURL(a),l=new Image;await new Promise((e,t)=>{l.onload=()=>{o.drawImage(l,0,0,n,s),URL.revokeObjectURL(r),e()},l.onerror=t,l.src=r});break;case"canvas":o.drawImage(e,0,0,n,s);break;case"video":e.readyState>=2?o.drawImage(e,0,0,n,s):await new Promise(t=>{e.addEventListener("loadeddata",()=>{o.drawImage(e,0,0,n,s),t()},{once:!0})});break;default:const c=window.getComputedStyle(e),d=e.textContent||e.innerText||"Text",m=parseFloat(c.fontSize),h=c.fontFamily,p=c.fontWeight,u=c.fontStyle,f=m*4;o.font=`${u} ${p} ${f}px ${h}`,o.fillStyle=t.particleColor||c.color,o.textAlign="center",o.textBaseline="middle",o.fillText(d,n/2,s/2)}}catch(e){console.error("Error converting element to canvas:",e),o.fillStyle="#333333",o.fillRect(n/4,s/4,n/2,s/2)}return i}async function c(e,t){let i;const o=e.dataset.modelSrc;if(o)try{const e=await async function(e,t){return new Promise((i,o)=>{if("undefined"==typeof THREE||!THREE.GLTFLoader)return console.error("particlesGL: THREE.js and THREE.GLTFLoader are required for model loading. Please include them in your project."),o("Missing THREE.js or GLTFLoader. Required for 3D model support.");(new THREE.GLTFLoader).load(e,n=>{const s=[],a=(new THREE.Box3).setFromObject(n.scene),r=a.getCenter(new THREE.Vector3),l=a.getSize(new THREE.Vector3),c=Math.max(l.x,l.y,l.z),d=t.modelScale/c;if(n.scene.traverse(e=>{if(e.isMesh){const t=e.geometry.attributes.position,i=new THREE.Vector3;e.updateWorldMatrix(!0,!1);for(let o=0;o<t.count;o++)i.fromBufferAttribute(t,o),i.applyMatrix4(e.matrixWorld),i.sub(r),i.multiplyScalar(d),s.push(i.x,i.y,i.z)}}),0===s.length)return console.warn(`particlesGL: No mesh geometry found in ${e}`),o(`No mesh geometry found in ${e}`);i(s)},void 0,t=>{console.error(`particlesGL: Failed to load 3D model from ${e}`,t),o(`Failed to load model: ${t}`)})})}(o,t);i={positions:e,colors:[]}}catch(n){console.error(`particlesGL: Could not process model ${o}.`,n);await l(e,t);i={positions:[],colors:[]}}else if(t.geometry)i={positions:t.geometry,colors:[]};else{const o=await l(e,t),n=o.getContext("2d").getImageData(0,0,o.width,o.height),s=[],a=[],r="sample"===t.particleColor,c="video"===e.tagName.toLowerCase(),d=128,m=80;for(let i=0;i<o.height;i+=t.sampling)for(let l=0;l<o.width;l+=t.sampling){const h=4*(i*o.width+l),p=n.data[h],u=n.data[h+1],f=n.data[h+2],g=n.data[h+3];let v=!1;if(c){const e=.299*p+.587*u+.114*f,t=Math.max(p,u,f);v=e>m&&t>50}else v=g>d;if(v){let n,c;if(!["img","svg","canvas","video"].includes(e.tagName.toLowerCase())){const t=Math.PI/180*75,s=1.15,a=2*Math.tan(t/2)*s,r=e.getBoundingClientRect(),d=a*(r.width/r.height);n=(l-o.width/2)/o.width*d,c=(o.height/2-i)/o.height*a}else n=(l-o.width/2)*t.particleSpacing,c=(o.height/2-i)*t.particleSpacing;if(s.push(n,c,0),r){const e=p/255,t=u/255,i=f/255;a.push(e,t,i)}}}i={positions:s,colors:a}}const{positions:n,colors:s}=i,a=[...n],r=[...s],c="sample"===t.particleColor&&s.length>0,m=new THREE.BufferGeometry;m.setAttribute("position",new THREE.Float32BufferAttribute(n,3)),m.setAttribute("originalPosition",new THREE.Float32BufferAttribute(a,3)),c&&(m.setAttribute("color",new THREE.Float32BufferAttribute(s,3)),m.setAttribute("originalColor",new THREE.Float32BufferAttribute(r,3)));const h=new THREE.PointsMaterial({size:t.particleSize,map:d(t.character,t,c),transparent:!0,alphaTest:.5,sizeAttenuation:!0,vertexColors:c}),p=new THREE.Points(m,h);return p.userData={options:t,useColorSampling:c},p}function d(e,t,i=!1){const o=document.createElement("canvas");o.width=64,o.height=64;const n=o.getContext("2d");n.fillStyle=i?"#ffffff":t.particleColor||"#8c8c8c",n.font=`${t.fontSize||48}px ${t.fontFamily||"monospace"}`,n.textAlign="center",n.textBaseline="middle",n.fillText(e,32,32);const s=new THREE.CanvasTexture(o);return s.minFilter=THREE.LinearFilter,s.magFilter=THREE.LinearFilter,s}class m{constructor(e,i){this.id="particles-gl-"+ ++t,this.options=e,this.elements=i,this.initialized=!1}async init(){if(!this.initialized){e||(e=new r,e.startAnimation(),function(){if(s)return;let e=window.innerWidth,t=window.innerHeight,o=window.devicePixelRatio;const n=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window&&window.innerWidth<1024,r=()=>{a&&clearTimeout(a),a=setTimeout(()=>{const s=window.innerWidth,a=window.innerHeight,r=window.devicePixelRatio,l=Math.abs(s-e)>10,c=!n&&Math.abs(a-t)>100;if(l||c||r!==o){for(const[,e]of i)e&&e.initialized&&(e.cleanup(!0),setTimeout(()=>{e.init()},50));e=s,t=a,o=r}},250)},l=()=>{n&&setTimeout(()=>{r()},500)};window.addEventListener("resize",r),n&&window.addEventListener("orientationchange",l);s={handleResize:r,handleOrientationChange:l,isMobile:n}}());for(let t=0;t<this.elements.length;t++){const i=this.elements[t];try{const o=await c(i,this.options),n=i.id||`element-${t}`;e.addParticleSystem(this.id+"-"+n,o,i,this.options)}catch(e){console.error("particlesGL: Failed to create particle system for element:",i,e)}}this.initialized=!0,i.set(this.id,this),this.options.on&&this.options.on.init&&this.options.on.init(this)}}cleanup(t=!1){if(this.initialized){for(let i=0;i<this.elements.length;i++){const o=this.elements[i].id||`element-${i}`;e.removeParticleSystem(this.id+"-"+o,t)}i.delete(this.id),0===i.size&&e&&(e.dispose(),e=null,function(){s&&(window.removeEventListener("resize",s.handleResize),s.isMobile&&window.removeEventListener("orientationchange",s.handleOrientationChange),s=null);a&&(clearTimeout(a),a=null)}()),this.initialized=!1}}updateOptions(e){const t={...this.options};this.options={...this.options,...e};const i=["target","geometry"];this.elements.every(e=>"video"===e.tagName.toLowerCase())||i.push("sampling","particleSpacing");i.some(i=>void 0!==e[i]&&e[i]!==t[i])?(this.cleanup(),setTimeout(()=>this.init(),100)):this.updateLiveProperties(e,t)}updateLiveProperties(t,i){if(e)for(let o=0;o<this.elements.length;o++){const n=this.elements[o].id||`element-${o}`,s=this.id+"-"+n,a=e.particleSystems.get(s);if(a){void 0!==t.displaceRadius&&(a.externalRadiusUpdate=!0),a.options={...a.options,...t},void 0!==t.videoUpdateRate&&(a.videoUpdateInterval=t.videoUpdateRate);const e=a.system.material;if(e){void 0!==t.particleSize&&(e.size=t.particleSize);const o=void 0!==t.character&&t.character!==i.character,n=void 0!==t.fontSize&&t.fontSize!==i.fontSize||void 0!==t.fontFamily&&t.fontFamily!==i.fontFamily,s=void 0!==t.particleColor&&t.particleColor!==i.particleColor;if(o||n||s){const t="sample"===this.options.particleColor,o="sample"===i.particleColor,n=e.map;e.map=d(this.options.character,this.options,t),n&&n.dispose(),e.vertexColors=t,t!==o&&(e.needsUpdate=!0)}}}}}createCharacterSprite(e,t,i=!1){const o=document.createElement("canvas");o.width=64,o.height=64;const n=o.getContext("2d");n.fillStyle=i?"#ffffff":t.particleColor||"#8c8c8c",n.font=`${t.fontSize||48}px ${t.fontFamily||"monospace"}`,n.textAlign="center",n.textBaseline="middle",n.fillText(e,32,32);const s=new THREE.CanvasTexture(o);return s.minFilter=THREE.LinearFilter,s.magFilter=THREE.LinearFilter,s}}window.particlesGL=function(e={}){const t={target:".particlesGL",character:"â€¢",particleSize:.015,particleSpacing:.002,particleColor:"sample",sampling:4,tilt:!1,tiltFactor:.2,tiltSpeed:.05,displaceStrength:.6,displaceRadius:.1,velocityInfluence:.3,returnSpeed:.05,fontSize:48,fontFamily:"monospace",videoUpdateRate:100,modelScale:1,geometry:null,on:{},...e},i=document.querySelectorAll(t.target);if(0===i.length)return console.error(`particlesGL: No elements found with selector "${t.target}"`),null;const o=new m(t,Array.from(i));return o.init(),{init:()=>o.init(),cleanup:()=>o.cleanup(),updateOptions:e=>o.updateOptions(e),options:o.options}}}();